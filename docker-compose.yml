version: '3.8'
services:
  managed-node:
    image: ubuntu:22.04
    container_name: ansible-managed-node
    ports:
      - "2222:22"
    environment:
      - ROOT_PASSWORD=ansible123
    volumes:
      - ./shared:/shared
    command: >
      bash -c "
      apt-get update &&
      apt-get install -y openssh-server sudo python3 &&
      mkdir -p /run/sshd &&
      echo 'root:$$ROOT_PASSWORD' | chpasswd &&
      sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config &&
      /usr/sbin/sshd -D
      "
